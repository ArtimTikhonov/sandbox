# ๐๏ธ ะะตัะพัะฝะธัะฐ ะผะธะบัะพัะตัะฒะธัะพะฒ (Microservices Sandbox)

ะะพะปะฝะพััะฝะบัะธะพะฝะฐะปัะฝะฐั ัะบะพัะธััะตะผะฐ ะผะธะบัะพัะตัะฒะธัะพะฒ ะฝะฐ ะฑะฐะทะต Spring Boot ั ะฟะพะปะฝัะผ ััะตะบะพะผ ะธะฝััะฐััััะบัััั ะดะปั ัะฐะทัะฐะฑะพัะบะธ ะธ ะผะพะฝะธัะพัะธะฝะณะฐ.

## ๐ ะกะพะดะตัะถะฐะฝะธะต

- [ะััะธัะตะบัััะฐ ัะธััะตะผั](#-ะฐััะธัะตะบัััะฐ-ัะธััะตะผั)
- [ะะพะผะฟะพะฝะตะฝัั ะฟัะพะตะบัะฐ](#-ะบะพะผะฟะพะฝะตะฝัั-ะฟัะพะตะบัะฐ)
- [ะัััััะน ััะฐัั](#-ะฑัััััะน-ััะฐัั)
- [API ะดะพะบัะผะตะฝัะฐัะธั](#-api-ะดะพะบัะผะตะฝัะฐัะธั)
- [ะะพะฝะธัะพัะธะฝะณ ะธ ะผะตััะธะบะธ](#-ะผะพะฝะธัะพัะธะฝะณ-ะธ-ะผะตััะธะบะธ)
- [ะกัััะบัััะฐ ะฟัะพะตะบัะฐ](#-ััััะบัััะฐ-ะฟัะพะตะบัะฐ)
- [ะะฐะทัะฐะฑะพัะบะฐ](#-ัะฐะทัะฐะฑะพัะบะฐ)

## ๐๏ธ ะััะธัะตะบัััะฐ ัะธััะตะผั

```
                    โโโโโโโโโโโโโโโโโโโ
                    โ   API Gateway   โ
                    โ    (Port 8000)  โ
                    โโโโโโโโโโโฌโโโโโโโโ
                              โ
                    โโโโโโโโโโโดโโโโโโโโ
                    โ                 โ
            โโโโโโโโโผโโโโโโโ  โโโโโโโโผโโโโโโโโโ
            โ Service One  โ  โ Service Two   โ
            โ (Port 8080)  โ  โ (Port 8081)   โ
            โโโโโโโโฌโโโโโโโโ  โโโโโโโโโฌโโโโโโโโ
                   โ                  โ
    โโโโโโโโโโโโโโโโผโโโโโโโโโโโโโโโโโโโผโโโโโโโโโโโโโโโ
    โ              โ                  โ              โ
โโโโโผโโโโ โโโโโโโโโผโโโโโ โโโโโโโโโโโโโผโโ โโโโโโโโโโโผโโโ
โ Redis โ โPostgreSQL  โ โ    Kafka    โ โPrometheus  โ
โ:6379  โ โ   :5432    โ โ   :9092     โ โ   :9090    โ
โโโโโโโโโ โโโโโโโโโโโโโโ โโโโโโโโโโโโโโโ โโโโโโโโโโโโโโ
```

## ๐๏ธ ะะพะผะฟะพะฝะตะฝัั ะฟัะพะตะบัะฐ

### ะะธะบัะพัะตัะฒะธัั

| ะกะตัะฒะธั | ะะพัั | ะะฟะธัะฐะฝะธะต | ะขะตัะฝะพะปะพะณะธะธ |
|--------|------|----------|------------|
| **API Gateway** | 8000 | ะะดะธะฝะฐั ัะพัะบะฐ ะฒัะพะดะฐ, ะผะฐัััััะธะทะฐัะธั ะทะฐะฟัะพัะพะฒ | Spring Cloud Gateway |
| **Service One** | 8080 | ะัะฝะพะฒะฝะพะน ะฑะธะทะฝะตั-ัะตัะฒะธั ั ะะ ะธ ะบะตัะตะผ | Spring Boot, JPA, Redis |
| **Service Two** | 8081 | ะกะตัะฒะธั-ะฟะพััะตะฑะธัะตะปั ัะพะพะฑัะตะฝะธะน | Spring Boot, Kafka Consumer |

### ะะฝััะฐััััะบัััะฐ

| ะะพะผะฟะพะฝะตะฝั | ะะพัั | ะะฟะธัะฐะฝะธะต |
|-----------|------|----------|
| **PostgreSQL** | 5432 | ะัะฝะพะฒะฝะฐั ะฑะฐะทะฐ ะดะฐะฝะฝัั |
| **Redis** | 6379 | ะะตั ะธ ัะตััะธะธ |
| **Kafka** | 9092 | ะัะตัะตะดั ัะพะพะฑัะตะฝะธะน |
| **Kafka UI** | 8090 | ะะตะฑ-ะธะฝัะตััะตะนั ะดะปั Kafka |
| **Prometheus** | 9090 | ะกะฑะพั ะผะตััะธะบ |
| **Grafana** | 3000 | ะะธะทัะฐะปะธะทะฐัะธั ะผะตััะธะบ |
| **Zookeeper** | 2181 | ะะพะพัะดะธะฝะฐัะพั ะดะปั Kafka |

## ๐ ะัััััะน ััะฐัั

### ะัะตะดะฒะฐัะธัะตะปัะฝัะต ััะตะฑะพะฒะฐะฝะธั

- Java 24+
- Docker ะธ Docker Compose
- Maven 3.9+

### ะะฐะฟััะบ ะฟัะพะตะบัะฐ

1. **ะะปะพะฝะธัะพะฒะฐะฝะธะต ะธ ะฟะตัะตัะพะด ะฒ ะดะธัะตะบัะพัะธั:**
```bash
git clone <repository-url>
cd sandbox
```

2. **ะกะฑะพัะบะฐ ะฟัะพะตะบัะฐ:**
```bash
mvn clean package -DskipTests
```

3. **ะะฐะฟััะบ ะฒัะตะน ะธะฝััะฐััััะบัััั:**
```bash
# ะัะธะฝัะดะธัะตะปัะฝะฐั ะฟะตัะตัะฑะพัะบะฐ (ะตัะปะธ ะฝัะถะฝะพ)
export REBUILD_DATE=$(date +%Y%m%d%H%M%S)

# ะะฐะฟััะบ ะฒัะตั ัะตัะฒะธัะพะฒ
docker-compose up -d

# ะัะพัะผะพัั ะปะพะณะพะฒ
docker-compose logs -f
```

4. **ะัะพะฒะตัะบะฐ ัะฐะฑะพัะพัะฟะพัะพะฑะฝะพััะธ:**
```bash
# API Gateway
curl http://localhost:8000/service-one/one/get

# Service One ะฝะฐะฟััะผัั
curl http://localhost:8080/one/get

# Service Two ะฝะฐะฟััะผัั
curl http://localhost:8081/two/get
```

### ะััะฐะฝะพะฒะบะฐ ะฟัะพะตะบัะฐ

```bash
# ะััะฐะฝะพะฒะบะฐ ะฒัะตั ัะตัะฒะธัะพะฒ
docker-compose down

# ะััะฐะฝะพะฒะบะฐ ั ัะดะฐะปะตะฝะธะตะผ volumes
docker-compose down -v
```

## ๐ API ะดะพะบัะผะตะฝัะฐัะธั

### API Gateway (ะฟะพัั 8000)

ะัะต ะทะฐะฟัะพัั ะฟัะพัะพะดัั ัะตัะตะท API Gateway ั ะฟัะตัะธะบัะฐะผะธ:

- `/service-one/**` โ ะฟะตัะตะฝะฐะฟัะฐะฒะปัะตััั ะฝะฐ Service One
- `/service-two/**` โ ะฟะตัะตะฝะฐะฟัะฐะฒะปัะตััั ะฝะฐ Service Two

### Service One API

**ะัะฝะพะฒะฝัะต ัะฝะดะฟะพะธะฝัั:**
```http
GET /one/get                    # ะัะพััะพะน ัะตัั
POST /api/messages              # ะัะฟัะฐะฒะบะฐ ัะพะพะฑัะตะฝะธั ะฒ Kafka
```

**Redis API:**
```http
POST /redis/set/{key}           # ะฃััะฐะฝะพะฒะธัั ะทะฝะฐัะตะฝะธะต
GET /redis/get/{key}            # ะะพะปััะธัั ะทะฝะฐัะตะฝะธะต
POST /redis/set/{key}/ttl/{sec} # ะฃััะฐะฝะพะฒะธัั ั TTL
DELETE /redis/delete/{key}      # ะฃะดะฐะปะธัั ะบะปัั
GET /redis/keys                 # ะัะต ะบะปััะธ
POST /redis/increment/{key}     # ะะฝะบัะตะผะตะฝั
```

**ะะตััะธะบะธ API:**
```http
GET /metrics/test               # ะขะตััะพะฒัะน ัะฝะดะฟะพะธะฝั ั ะผะตััะธะบะฐะผะธ
POST /metrics/increment-counter # ะะฝะบัะตะผะตะฝั ััะตััะธะบะฐ
GET /metrics/simulate-error     # ะกะธะผัะปััะธั ะพัะธะฑะพะบ
GET /metrics/long-operation     # ะะปะธัะตะปัะฝะฐั ะพะฟะตัะฐัะธั
GET /metrics/database-simulation # ะกะธะผัะปััะธั ะะ ะทะฐะฟัะพัะฐ
```

### Service Two API

```http
GET /two/get                    # ะัะพััะพะน ัะตัั
```

### ะัะธะผะตัั ะธัะฟะพะปัะทะพะฒะฐะฝะธั

**ะัะฟัะฐะฒะบะฐ ัะพะพะฑัะตะฝะธั ัะตัะตะท API Gateway:**
```bash
curl -X POST http://localhost:8000/service-one/api/messages \
  -H "Content-Type: application/json" \
  -d "ะัะธะฒะตั ะธะท API Gateway!"
```

**ะะฐะฑะพัะฐ ั Redis:**
```bash
# ะฃััะฐะฝะพะฒะธัั ะทะฝะฐัะตะฝะธะต
curl -X POST http://localhost:8080/redis/set/test-key \
  -H "Content-Type: application/json" \
  -d "ะขะตััะพะฒะพะต ะทะฝะฐัะตะฝะธะต"

# ะะพะปััะธัั ะทะฝะฐัะตะฝะธะต
curl http://localhost:8080/redis/get/test-key

# ะฃััะฐะฝะพะฒะธัั ั TTL (60 ัะตะบัะฝะด)
curl -X POST http://localhost:8080/redis/set/temp-key/ttl/60 \
  -H "Content-Type: application/json" \
  -d "ะัะตะผะตะฝะฝะพะต ะทะฝะฐัะตะฝะธะต"
```

## ๐ ะะพะฝะธัะพัะธะฝะณ ะธ ะผะตััะธะบะธ

### Grafana Dashboard
- **URL:** http://localhost:3000
- **ะะพะณะธะฝ:** admin
- **ะะฐัะพะปั:** admin

**ะะพัััะฟะฝัะต ะดะฐัะฑะพัะดั:**
- Spring Boot Service Dashboard
- Custom ะผะตััะธะบะธ ะฟัะธะปะพะถะตะฝะธะน
- JVM ะผะตััะธะบะธ

### Prometheus
- **URL:** http://localhost:9090
- ะะฒัะพะผะฐัะธัะตัะบะธะน ัะฑะพั ะผะตััะธะบ ั ะฒัะตั ัะตัะฒะธัะพะฒ
- ะะฐััะพะผะฝัะต ะผะตััะธะบะธ ะฟัะธะปะพะถะตะฝะธะน

### Kafka UI
- **URL:** http://localhost:8090
- ะัะพัะผะพัั ัะพะฟะธะบะพะฒ, ะฟะฐััะธัะธะน, ัะพะพะฑัะตะฝะธะน
- ะะพะฝะธัะพัะธะฝะณ consumer groups

### Health Checks

**Service One:**
```bash
curl http://localhost:8080/actuator/health
curl http://localhost:8080/actuator/metrics
curl http://localhost:8080/actuator/prometheus
```

**API Gateway:**
```bash
curl http://localhost:8000/actuator/health
```

## ๐ ะกัััะบัััะฐ ะฟัะพะตะบัะฐ

```
sandbox/
โโโ api-gateway/                    # API Gateway ะผะพะดัะปั
โ   โโโ src/main/java/
โ   โ   โโโ com/example/api_gateway/
โ   โ       โโโ config/
โ   โ       โ   โโโ GatewayConfig.java    # ะะพะฝัะธะณััะฐัะธั ะผะฐัััััะพะฒ
โ   โ       โโโ ApiGatewayApplication.java
โ   โโโ src/main/resources/
โ       โโโ application.yaml             # ะะฐัััะพะนะบะธ Gateway
โโโ service-one/                         # ะัะฝะพะฒะฝะพะน ัะตัะฒะธั
โ   โโโ src/main/java/
โ   โ   โโโ com/example/service/one/
โ   โ       โโโ config/                  # ะะพะฝัะธะณััะฐัะธะธ
โ   โ       โโโ controller/              # REST ะบะพะฝััะพะปะปะตัั
โ   โ       โโโ service/                 # ะะธะทะฝะตั ะปะพะณะธะบะฐ
โ   โ       โโโ ServiceOneApplication.java
โ   โโโ src/main/resources/
โ       โโโ application.yaml             # ะะฐัััะพะนะบะธ ะฟัะธะปะพะถะตะฝะธั
โ       โโโ db/migration/                # Flyway ะผะธะณัะฐัะธะธ
โ           โโโ V1__unit_schema.sql      # ะะฐัะฐะปัะฝะฐั ััะตะผะฐ ะะ
โโโ service-two/                         # ะะพััะตะฑะธัะตะปั ัะพะพะฑัะตะฝะธะน
โ   โโโ src/main/java/
โ   โ   โโโ com/example/service/two/
โ   โ       โโโ config/                  # Kafka ะบะพะฝัะธะณััะฐัะธั
โ   โ       โโโ controller/              # REST ะบะพะฝััะพะปะปะตัั
โ   โ       โโโ listener/                # Kafka listeners
โ   โ       โโโ ServiceTwoApplication.java
โ   โโโ src/main/resources/
โ       โโโ application.yaml
โโโ monitoring/                          # ะะพะฝัะธะณััะฐัะธะธ ะผะพะฝะธัะพัะธะฝะณะฐ
โ   โโโ grafana/
โ   โ   โโโ dashboards/                  # ะะพัะพะฒัะต ะดะฐัะฑะพัะดั
โ   โ   โโโ provisioning/                # ะะฒัะพะผะฐัะธัะตัะบะฐั ะฝะฐัััะพะนะบะฐ
โ   โโโ prometheus/
โ       โโโ prometheus.yml               # ะะพะฝัะธะณััะฐัะธั Prometheus
โโโ docker-compose.yml                   # ะัะบะตัััะฐัะธั ะฒัะตั ัะตัะฒะธัะพะฒ
โโโ Dockerfile                          # ะัะปััะธััะตะนะดะถ ัะฑะพัะบะฐ
โโโ pom.xml                             # ะะพะดะธัะตะปััะบะธะน Maven POM
```

## ๐ง ะะฐะทัะฐะฑะพัะบะฐ

### ะะพะบะฐะปัะฝะฐั ัะฐะทัะฐะฑะพัะบะฐ

**ะะฐะฟััะบ ัะพะปัะบะพ ะธะฝััะฐััััะบัััั:**
```bash
# ะะฐะฟััะบ ัะพะปัะบะพ ะะ, Redis, Kafka
docker-compose up -d postgres redis kafka zookeeper kafka-ui prometheus grafana
```

**ะะฐะฟััะบ ัะตัะฒะธัะพะฒ ะฒ IDE:**
```bash
# Service One
cd service-one
mvn spring-boot:run

# Service Two  
cd service-two
mvn spring-boot:run

# API Gateway
cd api-gateway
mvn spring-boot:run
```

### ะะฐัััะพะนะบะฐ ะฟัะพัะธะปะตะน

**ะัะพัะธะปะธ Spring:**
- `default` - ะดะปั ะปะพะบะฐะปัะฝะพะน ัะฐะทัะฐะฑะพัะบะธ
- `docker` - ะดะปั ะบะพะฝัะตะนะฝะตัะธะทะพะฒะฐะฝะฝะพะณะพ ะพะบััะถะตะฝะธั

### ะะฐะทะฐ ะดะฐะฝะฝัั

**ะะพะดะบะปััะตะฝะธะต ะบ PostgreSQL:**
```bash
docker exec -it postgres psql -U postgres -d sandbox
```

**Flyway ะผะธะณัะฐัะธะธ:**
- ะะฒัะพะผะฐัะธัะตัะบะธ ะฟัะธะผะตะฝััััั ะฟัะธ ััะฐััะต Service One
- ะะฐัะพะดัััั ะฒ `service-one/src/main/resources/db/migration/`

### ะขะตััะธัะพะฒะฐะฝะธะต Kafka

**ะัะฟัะฐะฒะบะฐ ัะพะพะฑัะตะฝะธั:**
```bash
curl -X POST http://localhost:8080/api/messages \
  -H "Content-Type: application/json" \
  -d "ะขะตััะพะฒะพะต ัะพะพะฑัะตะฝะธะต ะดะปั Kafka"
```

**ะัะพะฒะตัะบะฐ ะปะพะณะพะฒ Service Two:**
```bash
docker-compose logs -f service-two
```

### ะะตััะธะบะธ ะธ ะผะพะฝะธัะพัะธะฝะณ

**ะะฐััะพะผะฝัะต ะผะตััะธะบะธ ะฒ Service One:**
- `custom.api.calls` - ััะตััะธะบ ะฒัะทะพะฒะพะฒ API
- `custom.active.connections` - gauge ะฐะบัะธะฒะฝัั ะฟะพะดะบะปััะตะฝะธะน
- `custom.api.test.time` - ะฒัะตะผั ะฒัะฟะพะปะฝะตะฝะธั ัะตััะพะฒัั ะทะฐะฟัะพัะพะฒ
- `custom.database.query.time` - ะฒัะตะผั ะฒัะฟะพะปะฝะตะฝะธั ะะ ะทะฐะฟัะพัะพะฒ

**ะะพะฑะฐะฒะปะตะฝะธะต ะฝะพะฒัั ะผะตััะธะบ:**
```java
@Autowired
private MeterRegistry meterRegistry;

// ะกัะตััะธะบ
Counter.builder("my.custom.counter")
    .description("ะะฟะธัะฐะฝะธะต ััะตััะธะบะฐ")
    .tag("service", "my-service")
    .register(meterRegistry);

// Gauge
Gauge.builder("my.custom.gauge", atomicValue, AtomicInteger::get)
    .register(meterRegistry);
```

### ะะพะปะตะทะฝัะต ะบะพะผะฐะฝะดั

```bash
# ะะตัะตัะฑะพัะบะฐ ะบะพะฝะบัะตัะฝะพะณะพ ัะตัะฒะธัะฐ
docker-compose build service-one

# ะัะพัะผะพัั ะปะพะณะพะฒ ะบะพะฝะบัะตัะฝะพะณะพ ัะตัะฒะธัะฐ
docker-compose logs -f api-gateway

# ะะฐัััะฐะฑะธัะพะฒะฐะฝะธะต ัะตัะฒะธัะฐ
docker-compose up -d --scale service-one=2

# ะัะธััะบะฐ ะฝะตะธัะฟะพะปัะทัะตะผัั ัะตััััะพะฒ Docker
docker system prune -a

# ะัะพะฒะตัะบะฐ ััะฐัััะฐ ะฒัะตั ะบะพะฝัะตะนะฝะตัะพะฒ
docker-compose ps
```

---

## ๐ค ะะบะปะฐะด ะฒ ะฟัะพะตะบั

1. ะคะพัะบะฝะธัะต ัะตะฟะพะทะธัะพัะธะน
2. ะกะพะทะดะฐะนัะต ะฒะตัะบั ะดะปั ะฝะพะฒะพะน ััะฝะบัะธะธ (`git checkout -b feature/amazing-feature`)
3. ะะฐัะธะบัะธััะนัะต ะธะทะผะตะฝะตะฝะธั (`git commit -m 'Add amazing feature'`)
4. ะัะฟัะฐะฒััะต ะฒ ะฒะตัะบั (`git push origin feature/amazing-feature`)
5. ะัะบัะพะนัะต Pull Request

## ๐ ะะธัะตะฝะทะธั

ะญัะพั ะฟัะพะตะบั ะปะธัะตะฝะทะธัะพะฒะฐะฝ ะฟะพะด MIT License.

## ๐ ะะพะดะดะตัะถะบะฐ

ะัะปะธ ั ะฒะฐั ะฒะพะทะฝะธะบะปะธ ะฒะพะฟัะพัั ะธะปะธ ะฟัะพะฑะปะตะผั:

1. ะัะพะฒะตัััะต [Issues](../../issues) - ะฒะพะทะผะพะถะฝะพ, ะพัะฒะตั ัะถะต ะตััั
2. ะกะพะทะดะฐะนัะต ะฝะพะฒัะน Issue ั ะฟะพะดัะพะฑะฝัะผ ะพะฟะธัะฐะฝะธะตะผ ะฟัะพะฑะปะตะผั
3. ะะบะปััะธัะต ะปะพะณะธ ัะตัะฒะธัะพะฒ: `docker-compose logs > logs.txt`

**ะัะพะฒะตัะบะฐ ัะฐะฑะพัะพัะฟะพัะพะฑะฝะพััะธ ัะธััะตะผั:**
```bash
# ะัะพะฒะตัะบะฐ ะฒัะตั ัะตัะฒะธัะพะฒ ะพะดะฝะพะน ะบะพะผะฐะฝะดะพะน
curl -s http://localhost:8000/service-one/one/get && echo " โ API Gateway -> Service One" || echo " โ API Gateway -> Service One"
curl -s http://localhost:8000/service-two/two/get && echo " โ API Gateway -> Service Two" || echo " โ API Gateway -> Service Two"
curl -s http://localhost:3000/api/health && echo " โ Grafana" || echo " โ Grafana"
curl -s http://localhost:9090/-/healthy && echo " โ Prometheus" || echo " โ Prometheus"
```